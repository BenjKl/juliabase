{# -*- indent-tabs-mode: nil -*- #}
{% extends "samples/base.html" %}
{% comment %}
This file is part of JuliaBase, the samples database.

Copyright (C) 2010 Forschungszentrum Jülich, Germany,
                   Marvin Goblet <m.goblet@fz-juelich.de>,
                   Torsten Bronger <t.bronger@fz-juelich.de>

You must not use, install, pass on, offer, sell, analyse, modify, or distribute
this software without explicit permission of the copyright holder.  If you have
received a copy of this software without the explicit permission of the
copyright holder, you must destroy it immediately and completely.
{% endcomment %}

{% load i18n %}
{% load juliabase %}
{% load samples_extras %}

{% block css %}
<style type="text/css">
  table.padding td, table.padding th { padding: 3px }
</style>
{% endblock %}

{% block frame_content %}
{% url 'samples.views.status.show' as next_url %}
{% if status_messages %}
  <table class="padding" border="1">
     <thead>
       <tr style="vertical-align: top">
          <th>{% trans 'Process' %}</th>
          <th>{% verbose_name StatusMessage.message %}</th>
          <th>{% verbose_name StatusMessage.status_level %}</th>
          <th>{% verbose_name StatusMessage.begin %}</th>
          <th>{% verbose_name StatusMessage.end %}</th>
          <th>{% verbose_name StatusMessage.operator %}</th>
          <th>{% trans 'posted at' %}</th>
       </tr>
     </thead>
     <tbody>
      {% for status_message, process_name in status_messages %}
           <tr style="vertical-align: top">
              <td>{{ process_name|first_upper }}</td>
              <td>{{ status_message.message|markdown:"collapse" }}</td>
              <td style="text-align: center; vertical-align: middle">
                  {% if status_message.status_level == "undefined" %}
                      <img src="{{ STATIC_URL }}juliabase/icons/grey.png" alt="undefined"/>
                  {% else %}{% if status_message.status_level == "red" %}
                      <img src="{{ STATIC_URL }}juliabase/icons/red.png" alt="red"/>
                  {% else %}{% if status_message.status_level == "yellow" %}
                      <img src="{{ STATIC_URL }}juliabase/icons/yellow.png" alt="yellow"/>
                  {% else %}{% if status_message.status_level == "green" %}
                      <img src="{{ STATIC_URL }}juliabase/icons/green.png" alt="green"/>
                  {% endif %}{% endif %}{% endif %}{% endif %}
              </td>
              <td>{{ status_message|status_timestamp:"begin"|default_if_none:"—" }}</td>
              <td>{{ status_message|status_timestamp:"end"|default_if_none:"—" }}</td>
              <td>{{ status_message.operator|get_really_full_name }}</td>
              <td>{{ status_message.timestamp }}
                {% if user == status_message.operator %}
                  <form method="post" 
             action="{% url 'samples.views.status.withdraw' id_=status_message.id %}?next={{ next_url|urlquote_plus }}"
                        style="display: inline">
                    <input type="image" src="{{ STATIC_URL }}juliabase/icons/cancel.png" alt="{% trans 'cancel' %}"
                           title="{% trans 'withdraw this status message for all processes' %}"/>
                  </form>
                {% endif %}
              </td>
           </tr>
      {% endfor %}
     </tbody>
  </table>
{% else %}
  <p>{% trans 'There are no current status messages.' %}</p>
{% endif %}

<p><a href="{% url 'samples.views.status.add' %}?next={{ next_url|urlquote_plus }}" style="margin-right: 3em"
      >{% trans 'Add a status message' %}</a>
<a href="{% url 'samples.views.user_details.edit_preferences' login_name=user.username %}?next={{ next_url|urlquote_plus }}"
   >{% trans 'Subscribe to status messages' %}</a></p>


{% if further_status_messages %}
  <h2>{% trans "Further status messages" %}</h2>

  <table class="padding" border="1">
    <thead>
       <tr style="vertical-align: top; font-weight:bold">
          <th>{% trans 'Process' %}</th>
          <th>{% verbose_name StatusMessage.message %}</th>
          <th>{% verbose_name StatusMessage.status_level %}</th>
          <th>{% verbose_name StatusMessage.begin %}</th>
          <th>{% verbose_name StatusMessage.end %}</th>
          <th>{% verbose_name StatusMessage.operator %}</th>
          <th>{% trans 'posted at' %}</th>
       </tr>
    </thead>
    <tbody>
      {% for process_name, status_messages in further_status_messages %}
           {% for status_message in status_messages %}
             <tr style="vertical-align: top">
                {% if forloop.first %}
                  <td rowspan="{{ status_messages|length }}">{{ process_name|first_upper }}</td>
                {% endif %}
                <td>{{ status_message.message|markdown:"collapse" }}</td>
                <td style="text-align: center; vertical-align: middle">
                    {% if status_message.status_level == "undefined" %}
                        <img src="{{ STATIC_URL }}juliabase/icons/grey.png" alt="{% trans 'undefined' %}"/>
                    {% else %}{% if status_message.status_level == "red" %}
                        <img src="{{ STATIC_URL }}juliabase/icons/red.png" alt="{% trans 'red' %}"/>
                    {% else %}{% if status_message.status_level == "yellow" %}
                        <img src="{{ STATIC_URL }}juliabase/icons/yellow.png" alt="{% trans 'yellow' %}"/>
                    {% else %}{% if status_message.status_level == "green" %}
                        <img src="{{ STATIC_URL }}juliabase/icons/green.png" alt="{% trans 'green' %}"/>
                    {% endif %}{% endif %}{% endif %}{% endif %}
                </td>
                <td>{{ status_message|status_timestamp:"begin"|default_if_none:"—" }}</td>
                <td>{{ status_message|status_timestamp:"end"|default_if_none:"—" }}</td>
                <td>{{ status_message.operator|get_really_full_name }}</td>
                <td>{{ status_message.timestamp }}
                  {% if user == status_message.operator %}
                    <form method="post" 
              action="{% url 'samples.views.status.withdraw' id_=status_message.id %}?next={% url 'samples.views.status.show' %}"
                          style="display: inline">
                      <input type="image" src="{{ STATIC_URL }}juliabase/icons/cancel.png" alt="{% trans 'cancel' %}"
                             title="{% trans 'withdraw this status message for all processes' %}"/>
                    </form>
                  {% endif %}
                </td>
             </tr>
          {% endfor %}
      {% endfor %}
    </tbody>
  </table>

{% endif %}

{% endblock %}
