{# -*- indent-tabs-mode: nil -*- #}
{% extends "samples/base.html" %}
{% comment %}
This file is part of Chantal, the samples database.

Copyright (C) 2010 Forschungszentrum Jülich, Germany,
                   Marvin Goblet <m.goblet@fz-juelich.de>,
                   Torsten Bronger <t.bronger@fz-juelich.de>

You must not use, install, pass on, offer, sell, analyse, modify, or distribute
this software without explicit permission of the copyright holder.  If you have
received a copy of this software without the explicit permission of the
copyright holder, you must destroy it immediately and completely.
{% endcomment %}

{% load i18n %}
{% load chantal %}
{% load samples_extras %}

{% block local_scripts %}
<script type="text/javascript">
  // <![CDATA[
    update_datapath = function() {
	chantal.request("{% url chantal_ipv.views.samples.json_client.raman_file_path %}",
			function(data) { $("#id_datafile").val(data); },
			{sample_id: $("#id_sample").val(), apparatus: {{ apparatus }},
			 central_wavelength: $("#id_excitation_wavelength").val()});
    };
    update_substrate = function() {
        /* FixMe: This doesn't work yet.  A dedicated server function is needed
           which returns substrate information.  Alternatively, JavaScript
           could extract the substrate process itself. */
	/* chantal.request("{% url show_sample_by_id sample_id=0, path_suffix='' %}".slice(0, -1) + $("#id_sample").val(),
			function(data) { $("#substrate").text("(" + data["process #1"]["material"] + ")"); }); */
        
    };
    $(function() {
	$("#id_excitation_wavelength, #id_sample").change(update_datapath);
	$("#id_sample").change(update_substrate)
    })
  // ]]>
</script>
{% endblock %}

{% block frame_content %}
<form method="post">
  {% error_list raman_measurement _("Error in Raman data") %}
  {% error_list sample _("Error in sample") %}
  {% error_list remove_from_my_samples _("Error with removal from “My Samples”") %}
  <table class="padding5">
    <tbody>
    <tr>
      {% input_field raman_measurement.number %}
      {% input_field raman_measurement.timestamp %}
    </tr>
    <tr>
      <td class="label"><label for="id_{{ sample.sample.html_name }}"
           >{{ sample.sample.label }}:</label></td>
      <td class="input">{{ sample.sample }} <span id="substrate"/></td>
      {% input_field raman_measurement.through_substrate %}
    </tr>
    <tr>
       {% input_field raman_measurement.setup %}
       {% input_field raman_measurement.detector %}
    </tr>
    <tr>
      <td class="label">{{ raman_measurement.kind.label }}:</td>
      <td class="input" colspan="3">{{ raman_measurement.kind }}</td>
    </tr>
    <tr>
      {% input_field raman_measurement.filters %}
      {% input_field raman_measurement.objective %}
    </tr>
    <tr>
      {% input_field raman_measurement.grating %}
      {% input_field raman_measurement.slit %}
    </tr>
    <tr>
      {% input_field raman_measurement.time %}
      {% input_field raman_measurement.accumulation %}
    </tr>
    <tr>
      {% input_field raman_measurement.excitation_wavelength %}
      {% input_field raman_measurement.central_wavelength %}
    </tr>
    <tr>
      {% input_field raman_measurement.laser_power %}
      <td colspan="2"></td>
    </tr>
    <tr>
       {% input_field raman_measurement.dektak_measurement %}
       <td colspan="2"></td>
    </tr>
    <tr>
       {% input_field raman_measurement.sampling_period %}
       <td colspan="2"></td>
    </tr>
    <tr>
       {% input_field raman_measurement.sampling_distance_x %}
       {% input_field raman_measurement.number_points_x %}
    </tr>
    <tr>
       {% input_field raman_measurement.sampling_distance_y %}
       {% input_field raman_measurement.number_points_y %}
    </tr>
    <tr style="display: none">
      {% input_field raman_measurement.operator %}
      <td colspan="2"></td>
    </tr>
    <tr>
      <td class="label"><label for="id_{{ raman_measurement.datafile.html_name }}"
           >{{ raman_measurement.datafile.label }}:</label></td>
      <td class="input" colspan="3">{{ raman_measurement.datafile }}
        <span class="help">({{ raman_measurement.datafile.help_text }})</span></td>
    </tr>
    <tr>
      <td class="label"><label for="id_{{ raman_measurement.evaluated_datafile.html_name }}"
           >{{ raman_measurement.evaluated_datafile.label }}:</label></td>
      <td class="input" colspan="3">{{ raman_measurement.evaluated_datafile }}
        <span class="help">({{ raman_measurement.evaluated_datafile.help_text }})</span></td>
    </tr>
    <tr>
      <td class="label"><label for="id_{{ raman_measurement.comments.html_name }}"
           >{{ raman_measurement.comments.label }}:</label><br/>{% markdown_hint %}</td>
      <td class="input" colspan="3">{{ raman_measurement.comments }}</td>
    </tr>
    <tr>
       {% input_field raman_measurement.icrs %}
       <td colspan="2"></td>
    </tr>
    <tr>
       {% input_field raman_measurement.position_a_si %}
       {% input_field raman_measurement.width_a_si %}
    </tr>
    <tr>
       {% input_field raman_measurement.position_muc_si %}
       {% input_field raman_measurement.width_muc_si %}
    </tr>
    </tbody>
  </table>

  {% include "samples/edit_description.html" %}

  {% if remove_from_my_samples %}
    <div style="text-align: right; clear: both">
      {{ remove_from_my_samples.as_p }}
    </div>
  {% endif %}

  <div style="display: none">
    {{ raman_measurement.timestamp_inaccuracy }}
  </div>

  <p class="submit-button" style="clear: both"><input type="submit"/></p>
</form>


{% endblock %}
