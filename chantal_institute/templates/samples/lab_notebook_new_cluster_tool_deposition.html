{# -*- indent-tabs-mode: nil -*- #}
{% comment %}
This file is part of Chantal, the samples database.

Copyright (C) 2010 Forschungszentrum Jülich, Germany,
                   Marvin Goblet <m.goblet@fz-juelich.de>,
                   Torsten Bronger <t.bronger@fz-juelich.de>

You must not use, install, pass on, offer, sell, analyse, modify, or distribute
this software without explicit permission of the copyright holder.  If you have
received a copy of this software without the explicit permission of the
copyright holder, you must destroy it immediately and completely.
{% endcomment %}

{% load i18n %}
{% load samples_extras %}
{% load institute_extras %}

{% if processes %}
  <table class="lab-notebook">
    <colgroup span="2"></colgroup>
    <colgroup span="7" style="background-color: #bbffbb"></colgroup>
    <colgroup span="4"></colgroup>
    <colgroup span="2" style="background-color: #ffbbbb"></colgroup>
    <colgroup></colgroup>
    <colgroup span="2" style="background-color: #ffffbb"></colgroup>
    <colgroup></colgroup>
    <thead>
      <tr>
        <th class="top">{% trans 'number' %}</th>
        {# Translators: Of layer (p, i, or n) #}
        <th class="top">{% trans 'type' %}</th>
        <th class="top">{% verbose_name NewClusterToolPECVDLayer.sih4 %}</th>
        <th class="top">{% verbose_name NewClusterToolPECVDLayer.h2 %}</th>
        <th class="top">{% verbose_name NewClusterToolPECVDLayer.tmb %}</th>
        <th class="top">{% verbose_name NewClusterToolPECVDLayer.ch4 %}</th>
        <th class="top">{% verbose_name NewClusterToolPECVDLayer.ph3 %}</th>
        <th class="top">{% verbose_name NewClusterToolSputterLayer.ar %}</th>
        <th class="top">{% verbose_name NewClusterToolSputterLayer.o2 %}</th>
        <th class="top" style="font-style: italic">P</th>
        <th class="top" style="font-style: italic">p</th>
        <th class="top" style="font-style: italic">T</th>
        <th class="top"><span style="font-style: italic">f</span><sub>HF</sub></th>
        <th class="top" style="font-style: italic">I</th>
        {# Translators: "filament" #}
        <th class="top"><span style="font-style: italic">T</span><sub>{% trans 'filam.' %}</sub></th>
        <th class="top" style="font-style: italic">t</th>
        <th class="top">{% trans 'mode' %}</th>
        <th class="top">{% trans 'target' %}</th>
        <th class="top">{% trans 'comments' %}</th>
      </tr>
      <tr style="padding-top: -2ex">
        <th></th>
        <th></th>
        <th colspan="7" style="text-align: center">(sccm)</th>
        <th style="white-space: nowrap">(W)</th>
        <th style="white-space: nowrap">(mbar)</th>
        <th style="white-space: nowrap">(℃)</th>
        <th style="white-space: nowrap">(MHz)</th>
        <th style="white-space: nowrap">(A)</th>
        <th style="white-space: nowrap">(℃)</th>
        <th style="white-space: nowrap">(min)</th>
        <th></th>
        <th></th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for deposition in processes %}
        {% lab_notebook_comments deposition "before" %}
        {% for layer in deposition.layers.all %}
          {% with layer.actual_instance as layer %}
            <tr style="vertical-align: top">
            {% if forloop.first %}
              <td rowspan="{{ deposition.layers.count }}" class="top"{% if forloop.parentloop.last %} style="border-bottom: 2px solid"{% endif %}>
                <a href="{{ deposition.get_absolute_url }}">{{ deposition.number }}</a>
                {% if not deposition.finished %}
                  <br/><span style="color: red">{% trans "(not finished)" %}</span>
                {% endif %}
              </td>
            {% endif %}
              <td{% if forloop.first %} class="top"{% endif %} style="text-align: center{% if forloop.last and forloop.parentloop.last %}; border-bottom: 2px solid{% endif %}">{{ layer|cluster_tool_layer_type:"short" }}</td>
              <td{% if forloop.first %} class="top"{% endif %} style="text-align: '.'{% if forloop.last and forloop.parentloop.last %}; border-bottom: 2px solid{% endif %}">{{ layer.sih4|quantity|default_if_none:" " }}</td>
              <td{% if forloop.first %} class="top"{% endif %} style="text-align: '.'{% if forloop.last and forloop.parentloop.last %}; border-bottom: 2px solid{% endif %}">{{ layer.h2|quantity|default_if_none:" " }}</td>
              <td{% if forloop.first %} class="top"{% endif %} style="text-align: '.'{% if forloop.last and forloop.parentloop.last %}; border-bottom: 2px solid{% endif %}">{{ layer.tmb|quantity|default_if_none:" " }}</td>
              <td{% if forloop.first %} class="top"{% endif %} style="text-align: '.'{% if forloop.last and forloop.parentloop.last %}; border-bottom: 2px solid{% endif %}">{{ layer.ch4|quantity|default_if_none:" " }}</td>
              <td{% if forloop.first %} class="top"{% endif %} style="text-align: '.'{% if forloop.last and forloop.parentloop.last %}; border-bottom: 2px solid{% endif %}">{{ layer.ph3|quantity|default_if_none:" " }}</td>
              <td{% if forloop.first %} class="top"{% endif %} style="text-align: '.'{% if forloop.last and forloop.parentloop.last %}; border-bottom: 2px solid{% endif %}">{{ layer.ar|quantity|default_if_none:" " }}</td>
              <td{% if forloop.first %} class="top"{% endif %} style="text-align: '.'{% if forloop.last and forloop.parentloop.last %}; border-bottom: 2px solid{% endif %}">{{ layer.o2|quantity|default_if_none:" " }}</td>
              <td{% if forloop.first %} class="top"{% endif %}{% if forloop.last and forloop.parentloop.last %} style="border-bottom: 2px solid"{% endif %}>{{ layer.deposition_power|quantity|default_if_none:" " }}</td>
              <td{% if forloop.first %} class="top"{% endif %} style="text-align: '.'{% if forloop.last and forloop.parentloop.last %}; border-bottom: 2px solid{% endif %}">{{ layer.pressure|quantity|default_if_none:" " }}</td>
              <td{% if forloop.first %} class="top"{% endif %}{% if forloop.last and forloop.parentloop.last %} style="border-bottom: 2px solid"{% endif %}>{{ layer.heating_temperature|quantity|default_if_none:" " }}</td>
              <td{% if forloop.first %} class="top"{% endif %} style="text-align: '.'{% if forloop.last and forloop.parentloop.last %}; border-bottom: 2px solid{% endif %}">{{ layer.deposition_frequency|default_if_none:" " }}</td>
              <td{% if forloop.first %} class="top"{% endif %} style="text-align: '.'{% if forloop.last and forloop.parentloop.last %}; border-bottom: 2px solid{% endif %}">{{ layer.current|quantity|default_if_none:" " }}</td>
              <td{% if forloop.first %} class="top"{% endif %} style="text-align: '.'{% if forloop.last and forloop.parentloop.last %}; border-bottom: 2px solid{% endif %}">{{ layer.filament_temperature|default_if_none:" " }}</td>
              <td{% if forloop.first %} class="top"{% endif %} style="text-align: '.'{% if forloop.last and forloop.parentloop.last %}; border-bottom: 2px solid{% endif %}">{% ifequal layer|cluster_tool_layer_type "sputter" %}{{ layer.sputter_time|quantity|default:" " }}{% else %}{{ layer.time|hms_to_minutes|default:" " }}{% endifequal %}</td>
              <td{% if forloop.first %} class="top"{% endif %}{% if forloop.last and forloop.parentloop.last %} style="border-bottom: 2px solid"{% endif %}>{{ layer|sputter_mode|default_if_none:" " }}</td>
              <td{% if forloop.first %} class="top"{% endif %}{% if forloop.last and forloop.parentloop.last %} style="border-bottom: 2px solid"{% endif %}><span style="font-size: small">{{ layer|sputter_target|default_if_none:" " }}</span></td>
              {% if forloop.first %}
                <td rowspan="{{ deposition.layers.count }}"{% if forloop.first %} class="top"{% endif %}{% if forloop.parentloop.last %} style="border-bottom: 2px solid"{% endif %}>
                  <div style="float: right; marging-left: 3em; margin-bottom: 2ex; border-left: 1px solid;
                              border-bottom: 1px solid" class="timestamp">
                    {{ deposition|timestamp:"3" }}</div>{{ deposition.comments|markdown_samples:"collapse" }}</td>
              {% endif %}
            </tr>
          {% endwith %}
        {% endfor %}
        {% lab_notebook_comments deposition "after" %}
      {% endfor %}
    </tbody>
  </table>
{% else %}
  <p>{% trans 'No data found for this time range.' %}</p>
{% endif %}
